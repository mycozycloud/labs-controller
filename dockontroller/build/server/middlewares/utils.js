// Generated by CoffeeScript 1.7.1
var fs, token;

fs = require('fs');

token = "";

module.exports.initToken = (function(_this) {
  return function(cb) {
    if (fs.existsSync('/etc/cozy/controller.token')) {
      return fs.readFile('/etc/cozy/controller.token', 'utf8', function(err, data) {
        if (err == null) {
          token = data.split('\n')[0];
        }
        return cb();
      });
    } else {
      console.log("Option auth cannot work : file '/etc/cozy/controller.token doesn't exist");
      return cb();
    }
  };
})(this);

module.exports.checkToken = (function(_this) {
  return function(req, res, next) {
    var err, _ref;
    if ((((_ref = req.headers) != null ? _ref['x-auth-token'] : void 0) != null) && req.headers['x-auth-token'] === token) {
      return next();
    } else {
      err = new Error('not authorized');
      err.status = 401;
      return next(err);
    }
  };
})(this);

module.exports.getToken = (function(_this) {
  return function() {
    return token;
  };
})(this);
